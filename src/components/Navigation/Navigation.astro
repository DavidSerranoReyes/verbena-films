---
/**
 * ðŸŽ¬ NAVIGATION COMPONENT
 * Barra de navegaciÃ³n con selector de idiomas
 */
import { t, type Language } from '../../utils/i18n';

const SITE_CONFIG = {
  navigation: [
    { id: 'home', label: 'home', href: '/' },
    { id: 'films', label: 'films', href: '/films' },
    { id: 'about', label: 'about', href: '/about' },
    { id: 'news', label: 'news', href: '/news' },
  ],
};

interface Props {
  currentLang?: Language;
}

const { currentLang = 'es' } = Astro.props;
---

<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo -->
    <div class="navbar-logo">
      <a href="/">
        <picture>
          <source srcset="/images/logo/verbenafilms.webp" type="image/webp" />
          <img src="/images/logo/verbenafilms.png" alt="Verbena Films" class="logo-image" />
        </picture>
      </a>
    </div>

    <!-- Desktop Navigation Links -->
    <ul class="navbar-links-desktop" id="navbarLinksDesktop">
      {
        SITE_CONFIG.navigation.map((item) => (
          <li>
            <a href={item.href} class="nav-link">
              <span class="lang-es">{t(`nav.${item.label}`, 'es')}</span>
              <span class="lang-en" style="display:none;">{t(`nav.${item.label}`, 'en')}</span>
            </a>
          </li>
        ))
      }
    </ul>

    <!-- Right Controls Group: Language Switcher + Menu -->
    <div class="navbar-right-controls">
      <!-- Language Switcher -->
      <div class="language-switcher">
        <button
          class={`lang-btn ${currentLang === 'es' ? 'active' : ''}`}
          data-lang="es"
          aria-label="Cambiar a EspaÃ±ol"
        >
          ES
        </button>
        <span class="lang-divider">/</span>
        <button
          class={`lang-btn ${currentLang === 'en' ? 'active' : ''}`}
          data-lang="en"
          aria-label="Switch to English"
        >
          EN
        </button>
      </div>

      <!-- Menu Toggle (Mobile) -->
      <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
        <span class="hamburger-line line-1"></span>
        <span class="hamburger-line line-2"></span>
        <span class="hamburger-line line-3"></span>
      </button>

      <!-- Desktop Menu Button -->
      <button class="desktop-menu-btn" id="desktopMenuBtn" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Menu Overlay -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- Mobile Menu (Outside navbar) -->
<ul class="navbar-links-mobile" id="navbarLinks">
  {
    SITE_CONFIG.navigation.map((item) => (
      <li>
        <a href={item.href} class="nav-link">
          <span class="lang-es">{t(`nav.${item.label}`, 'es')}</span>
          <span class="lang-en" style="display:none;">{t(`nav.${item.label}`, 'en')}</span>
        </a>
      </li>
    ))
  }
</ul>

<style>
  .navbar {
    position: fixed;
    top: 0;
    width: 100%;
    height: var(--spacing-2xl);
    background: rgba(15, 15, 15, 0.3);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(212, 168, 184, 0.2);
    z-index: 10002;
  }

  .navbar-container {
    width: 100%;
    padding: 0 var(--spacing-lg);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    gap: var(--spacing-md);

    @media (max-width: 768px) {
      padding: 0 var(--spacing-sm);
      gap: var(--spacing-sm);
    }
  }

  .navbar-logo {
    flex-shrink: 0;
    margin-left: 0;

    @media (max-width: 768px) {
      margin-left: 0;
    }
  }

  .navbar-right-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-left: auto;
    margin-right: var(--spacing-sm);
    flex-shrink: 0;
    position: relative;
    z-index: 10003;

    @media (max-width: 768px) {
      margin-right: 0;
      gap: var(--spacing-sm);
    }
  }

  .navbar-logo a {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    text-decoration: none;
    transition: opacity var(--transition-default);

    &:hover {
      opacity: 0.8;
    }
  }

  .logo-image {
    height: 40px;
    width: auto;
    object-fit: contain;
    filter: invert(1) brightness(1.1);
    
    @media (max-width: 768px) {
      height: 32px;
    }
  }

  .logo-text {
    color: var(--color-text-primary);

    &.accent {
      color: var(--color-accent);
    }
  }

  .menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    position: relative;
    width: 40px;
    height: 40px;
    color: var(--color-text-primary);
    transition: all var(--transition-default);
    order: 2;
    overflow: hidden;
    z-index: 10003;

    @media (max-width: 768px) {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 6px;
    }

    &:hover {
      color: var(--color-accent);
    }

    &.active {
      color: var(--color-accent);
      gap: 0;
    }
  }

  .hamburger-line {
    display: block;
    width: 22px;
    height: 2px;
    background: currentColor;
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center center;
  }

  .menu-toggle.active {
    .line-1 {
      transform: rotate(45deg);
    }

    .line-2 {
      opacity: 0;
      transform: scaleX(0);
    }

    .line-3 {
      transform: rotate(-45deg);
    }
  }

  .navbar-links-desktop {
    display: none;
    list-style: none;
    gap: var(--spacing-xl);
    margin: 0;
    padding: 0;
    flex: 1;
    justify-content: center;

    @media (min-width: 769px) {
      &.active {
        display: flex;
      }
    }
  }

  .navbar-links-mobile {
    position: fixed;
    top: 0;
    right: 0;
    width: 70%;
    max-width: 400px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 0;
    background: rgba(15, 15, 15, 0.98);
    backdrop-filter: blur(20px);
    border-left: 2px solid rgba(212, 168, 184, 0.3);
    padding-top: calc(var(--spacing-2xl) + var(--spacing-lg));
    padding-bottom: var(--spacing-lg);
    padding-left: 0;
    padding-right: 0;
    overflow-y: auto;
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 10001;
    box-shadow: -8px 0 32px rgba(0, 0, 0, 0.6);
    justify-content: flex-start;
    list-style: none;
    margin: 0;

    &.active {
      transform: translateX(0);
    }

    @media (min-width: 769px) {
      display: none;
    }

    li {
      opacity: 1 !important;
      transition: background-color 0.2s ease;
      margin-bottom: var(--spacing-md);
      
      &:hover {
        background-color: rgba(212, 168, 184, 0.05);
      }
      
      &:active {
        background-color: rgba(212, 168, 184, 0.1);
      }
    }
  }

  .nav-link {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: var(--font-weight-regular);
    transition: color var(--transition-default);
    display: block;
    padding: var(--spacing-sm) 0;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 1px;
    position: relative;
    cursor: pointer;

    &::before {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--color-accent), transparent);
      transition: width var(--transition-default);
    }

    &:hover {
      color: var(--color-accent);

      &::before {
        width: 100%;
      }
    }
  }

  .navbar-links-mobile .nav-link {
    padding: var(--spacing-md) var(--spacing-xl);
    font-size: 1.25rem;
    color: #ffffff !important;
    font-weight: 400;
    position: relative;
    z-index: 10000;
    transition: all 0.2s ease;
    letter-spacing: 1px;
    
    span {
      color: #ffffff !important;
      pointer-events: none;
    }

    &::before {
      display: none;
    }
    
    &:hover {
      color: var(--color-accent) !important;
      
      span {
        color: var(--color-accent) !important;
      }
    }
    
    &:active {
      transform: translateX(4px);
    }
  }

  .language-switcher {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;

    @media (max-width: 768px) {
      position: static;
      margin: 0;
      order: 1;
    }
  }

  .lang-btn {
    background: none;
    border: none;
    color: var(--color-text-secondary);
    font-size: 0.85rem;
    font-weight: var(--font-weight-bold);
    cursor: pointer;
    transition: all var(--transition-default);
    padding: 0;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;

    &::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--color-accent);
      transition: width var(--transition-default);
    }

    &:hover {
      color: var(--color-accent);

      &::after {
        width: 100%;
      }
    }

    &.active {
      color: var(--color-accent);

      &::after {
        width: 100%;
      }
    }
  }

  .lang-divider {
    color: var(--color-text-secondary);
  }

  /* Desktop Menu Button */
  .desktop-menu-btn {
    display: none;
    background: none;
    border: none;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: color var(--transition-default);
    padding: 0;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 32px;
    height: 32px;
    font-size: 28px;
    flex-shrink: 0;

    @media (min-width: 769px) {
      display: flex;
    }

    &:hover {
      color: var(--color-accent);

      :global(svg) {
        animation: menuPulse 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
    }

    &.active {
      color: var(--color-accent);
    }

    :global(svg) {
      width: 1em;
      height: 1em;
    }
  }

  @keyframes menuPulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.15);
    }
    100% {
      transform: scale(1);
    }
  }

  /* Dropdown Menu - NOT IN USE */
  .dropdown-overlay {
    display: none;
  }

  /* Mobile Menu Overlay */
  .mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.4s ease, visibility 0.4s ease;
    z-index: 10000;
    backdrop-filter: blur(4px);
    pointer-events: none;

    &.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
  }
</style>

<script>
  // Esperar a que el DOM estÃ© completamente cargado
  document.addEventListener('DOMContentLoaded', () => {
    // ==================== MOBILE MENU ====================
    const menuToggle = document.getElementById('menuToggle');
    const navbarLinks = document.getElementById('navbarLinks');
    const mobileOverlay = document.getElementById('mobileOverlay');

    if (menuToggle && navbarLinks && mobileOverlay) {
      // Toggle mobile menu
      menuToggle.addEventListener('click', () => {
        console.log('Menu toggle clicked'); // Debug
        menuToggle.classList.toggle('active');
        navbarLinks.classList.toggle('active');
        mobileOverlay.classList.toggle('active');
        document.body.style.overflow = menuToggle.classList.contains('active') ? 'hidden' : '';
      });

      // Close menu when clicking overlay
      mobileOverlay.addEventListener('click', () => {
        menuToggle.classList.remove('active');
        navbarLinks.classList.remove('active');
        mobileOverlay.classList.remove('active');
        document.body.style.overflow = '';
      });

      // Close menu when clicking a link
      const mobileLinks = navbarLinks.querySelectorAll('a');
      mobileLinks.forEach((link) => {
        link.addEventListener('click', () => {
          menuToggle.classList.remove('active');
          navbarLinks.classList.remove('active');
          mobileOverlay.classList.remove('active');
          document.body.style.overflow = '';
        });
      });
    }

    // ==================== DESKTOP MENU ====================
    const desktopMenuBtn = document.getElementById('desktopMenuBtn');
    const navbarLinksDesktop = document.getElementById('navbarLinksDesktop');

    if (desktopMenuBtn && navbarLinksDesktop) {
      desktopMenuBtn.addEventListener('click', () => {
        navbarLinksDesktop.classList.toggle('active');
      });

      // Close menu when clicking a link
      const links = navbarLinksDesktop.querySelectorAll('a');
      links.forEach((link) => {
        link.addEventListener('click', () => {
          navbarLinksDesktop.classList.remove('active');
        });
      });

      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!desktopMenuBtn.contains(e.target as Node) && !navbarLinksDesktop.contains(e.target as Node)) {
          navbarLinksDesktop.classList.remove('active');
        }
      });
    }

    // ==================== LANGUAGE SWITCHER ====================
    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const lang = btn.getAttribute('data-lang');
        
        if (lang === 'es' || lang === 'en') {
          localStorage.setItem('verbena-lang', lang);
          document.documentElement.setAttribute('lang', lang);
          
          if (typeof (window as any).applyGlobalLanguage === 'function') {
            (window as any).applyGlobalLanguage();
          }
        }
      });
    });
  });
</script>
