---
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  lang?: 'es' | 'en';
}

const { 
  title = 'Verbena Films', 
  description = 'Producciones audiovisuales de excelencia',
  lang = 'es'
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <meta name="theme-color" content="#0f0f0f" />
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/images/og-image.jpg" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/logo/verbena-film-color.png" />
    <link rel="shortcut icon" type="image/png" href="/images/logo/verbena-film-color.png" />
    
    <!-- Preconnect to Google Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Title -->
    <title>{title} | Verbena Films</title>
  </head>
  <body>
    <slot />
    
    <!-- Language System Script -->
    <script is:inline>
      /**
       * Sistema Global de Idiomas
       * Sincroniza el idioma entre todos los componentes
       */
      
      // Detecta y establece el idioma preferido del usuario
      function initLanguage() {
        try {
          const stored = localStorage.getItem('verbena-lang');
          
          // Si ya hay un idioma guardado, usarlo
          if (stored && (stored === 'es' || stored === 'en')) {
            document.documentElement.setAttribute('lang', stored);
            return stored;
          }
          
          // Si no hay idioma guardado, DEFAULT a ESPAÑOL
          const defaultLang = 'es';
          localStorage.setItem('verbena-lang', defaultLang);
          document.documentElement.setAttribute('lang', defaultLang);
          
          return defaultLang;
        } catch (error) {
          console.error('Error initializing language:', error);
          return 'es';
        }
      }
      
      // Función global para aplicar idioma a todos los componentes
      window.applyGlobalLanguage = function() {
        const lang = localStorage.getItem('verbena-lang') || 'es';
        
        // Mostrar/ocultar textos según idioma en TODA la página
        document.querySelectorAll('.lang-es').forEach(el => {
          el.style.display = (lang === 'es') ? 'inline' : 'none';
        });
        document.querySelectorAll('.lang-en').forEach(el => {
          el.style.display = (lang === 'en') ? 'inline' : 'none';
        });
        
        // Actualizar botones activos
        document.querySelectorAll('.lang-btn').forEach(btn => {
          const btnLang = btn.getAttribute('data-lang');
          if (btnLang === lang) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      };
      
      // Inicializar al cargar la página
      initLanguage();
      
      // Aplicar idioma cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          window.applyGlobalLanguage();
        });
      } else {
        window.applyGlobalLanguage();
      }
    </script>
  </body>
</html>
